docker:
  image: "sfount/bhima:latest"
architect:
- sfount
install:
- cp /home/r/.env.production /home/r/repo/
- cp /home/r/.env.development /home/r/repo/
- cp /home/r/.env.staging /home/r/repo/
- sudo service mysql start
- npm install 
- bower install
assets:
  .env.production: "sfount/sfount-bhima-assets#.env.production"
  .env.development: "sfount/sfount-bhima-assets#.env.development"
  .env.staging: "sfount/sfount-bhima-assets#.env.staging"
merge: 
  script: |-
    echo "Setting up ENV..."
    /bin/bash /opt/dependencies.sh
    export $(sed -e '/^#/d' .env.development | xargs)
    ./sh/install.sh
    echo "Building..."
    ./node_modules/.bin/gulp build
    echo "Running integration tests..."
    ./sh/integration-tests.sh
    echo "Setting up end to end tests..."
    export DISPLAY=:99
    export CHROME_USER_DATA_DIR=/root/.config/google-chrome/
    ./sh/test-ends.sh
    echo "Complete (more tests to follow)..."
